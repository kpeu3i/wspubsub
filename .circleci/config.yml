version: 2

orbs:
    codecov: codecov/codecov@1.0.2

jobs:
    tests:
        docker:
            - image: circleci/golang:1.12
        steps:
            - checkout
            - restore_cache:
                  keys:
                      - go-mod-v4-{{ checksum "go.sum" }}
            - run:
                  name: Run unit tests
                  command: make test
            - codecov/upload:
                file: coverage.out
                flags: unit-tests
            - save_cache:
                  key: go-mod-v4-{{ checksum "go.sum" }}
                  paths:
                      - "/go/pkg/mod"

workflows:
    version: 2
    tests:
        jobs:
            - tests